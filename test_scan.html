<!DOCTYPE html>
<html>
<head>
    <title>Test Scanning</title>
</head>
<body>
    <h2>Test FoodSense AI Scanning</h2>
    <form id="scanForm">
        <input type="file" id="imageFile" accept="image/*" required>
        <br><br>
        <input type="text" id="productName" placeholder="Product Name" value="Snickers Chocolate Bar">
        <br><br>
        <textarea id="extractedText" placeholder="Extracted Text" rows="4" cols="50">
Snickers chocolate bar ingredients: milk chocolate (sugar, cocoa butter, chocolate, skim milk, lactose, milkfat, soy lecithin, artificial flavor), peanuts, corn syrup, sugar, palm oil, skim milk, lactose, salt, egg whites, artificial flavor. Contains: milk, egg, peanut, soy. May contain tree nuts.
        </textarea>
        <br><br>
        <button type="submit">Test Scan</button>
    </form>

    <div id="result"></div>

    <script>
        document.getElementById('scanForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData();
            const fileInput = document.getElementById('imageFile');
            const productName = document.getElementById('productName').value;
            const extractedText = document.getElementById('extractedText').value;
            
            if (fileInput.files[0]) {
                formData.append('image', fileInput.files[0]);
            }
            formData.append('productName', productName);
            formData.append('extractedText', extractedText);
            formData.append('userId', '1');  // Test user
            formData.append('allergies', JSON.stringify(['peanuts', 'milk']));
            
            try {
                const response = await fetch('/api/products/analyze', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                document.getElementById('result').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (error) {
                document.getElementById('result').innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        });
    </script>
</body>
</html>